{{/* mixcloud partial partial */}}

<div class="mixcloud-block">
    <div class="center-text">
        <span id="mixcloud-title">Missed the Show? Play it Back!</span>
    </div>
    <div id="mixcloud-latest"></div>
</div>

<script>
  async function loadLatestMixcloud() {
    const username = "RadioReboot";
    const container = document.getElementById("mixcloud-latest");

    try {
      const apiUrl = `https://api.mixcloud.com/${username}/cloudcasts/`;
      const response = await fetch(apiUrl);
      const data = await response.json();

      if (!data.data || data.data.length === 0) {
        container.innerHTML = "No uploads found.";
        return;
      }

      const latest = data.data[0];

      const embedUrl = `https://player-widget.mixcloud.com/widget/iframe/?hide_cover=1&feed=${encodeURIComponent(latest.key)}`;

      container.innerHTML = `
      <iframe width="100%" height="100%" src="${embedUrl}" frameborder="0" allow="encrypted-media; fullscreen; autoplay; idle-detection; speaker-selection; web-share;" ></iframe>
      `;
    } catch (err) {
      container.innerHTML = "Error loading Mixcloud feed.";
      console.error(err);
    }
  }

  loadLatestMixcloud();
</script>
